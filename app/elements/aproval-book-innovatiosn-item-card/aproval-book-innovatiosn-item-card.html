<link rel="import" href="..\..\bower_components/polymer/polymer.html">

<dom-module id="aproval-book-innovatiosn-item-card">
  <template>
    <style>
      :host {
        display: block;
      }
      table
      {
          table-layout: fixed;
          width: 1300px;
          border-collapse: collapse;
          margin-left: 26%;
      }
     paper-textarea
      {
        overflow-x: hidden;
        overflow-y: visible;
        height: 50px;
      }

      #dzfsd
      {
          border-radius: 10px;

          width: 250px;
          height: 320px;
          overflow-x: hidden;
          overflow-y: visible;
      }
      #dzfsd1xsasa
      {
          border-radius: 10px;
          width: 250px;
          height: 320px;
          width: 280px;
          

      }
    </style>
    <div>
           <paper-input value={{rowid}} hidden></paper-input>
           <paper-input value={{conceptid}} hidden></paper-input>
           <paper-input value={{capterid}} hidden></paper-input>
           <paper-input value={{rowidz}} hidden></paper-input>
        <table border="0">
           <tr style="border-bottom: 1px solid #ccc; line-height: 1.8em;border-color:#6699ff">
           <td>{{rowid}}</td>
             <td>
              <paper-icon-button icon="add" on-click="fngetconceptz" style="color:#6699ff;position: absolute;margin-left: 3%;"></paper-icon-button>
              <template is="dom-repeat" items="{{conceptzz}}" as="r">
               <h4>{{r.conceptname}}</h4>
             </template>
              
             
             </td>
             <td><paper-input value={{period}}></paper-input> </td>
             <td ><paper-input hidden$="{{hidecheck}}" value={{planneddate}}></paper-input>
             <from-book-date-picker hidden$="{{hidecheck1}}"></from-book-date-picker></td>
             <td><paper-textarea  readonly$="{{skillvaluezs}}" value={{skill}}></paper-textarea></td>
            <td>
             <paper-textarea  readonly$="{{skillvaluezs}}" value={{valuez}}></paper-textarea>
              <!--  <paper-icon-button icon="add" on-click="fngetconceptz1" style="color:#6699ff;position: absolute;margin-left: 3%;"></paper-icon-button>
                <template is="dom-repeat" items="{{massvalue}}" as="sr">
               <h4>{{sr.valuename}}</h4>
             </template>
               -->
               
            </td>
            <td><paper-textarea  readonly$="{{innovattionvaluezs}}" value={{innovation}}></paper-textarea></td> 

            <td><paper-input value={{remark}}></paper-input></td>
              
              <td>
                <paper-icon-button   hidden$="{{hidecheck1}}"  icon="save" on-click="fnsavebook"></paper-icon-button>
                <paper-icon-button  hidden$="{{hidecheck}}"  icon="create" on-click="fneditbook"></paper-icon-button> 
              </td>
              <td>
                <paper-icon-button icon="close" on-click="fndelete"></paper-icon-button>
              </td>
           </tr>
       </table>
     </div>

    <paper-dialog id="dzfsd" modal>
       <h3>Concept Name</h3>
      <template is="dom-repeat" items="{{conceparr}}" as="s">
         <concept-check-card conceptid="{{s.concept_id}}" id="FFYJ{{rowid}}{{iddate}}{{s.concept_id}}" conceptname="{{s.concept}}" check="{{s.check}}" rowid="{{rowid}}"></concept-check-card>
      </template>  
      <center style="margin-top: 5%;">
          <paper-button on-click="fnsubmit"  style="background-color:black;color:white">Submit</paper-button>
         <paper-button on-click="fnclose" style="background-color:black;color:white">Close</paper-button>
      </center>
    </paper-dialog>

     <paper-dialog id="dzfsd1xsasa" modal>
       <h3>Value Name</h3>
      <template is="dom-repeat" items="{{valuearrz}}" as="ss">
         <aproval-book valueid="{{ss.value_id}}" id="VVYJ{{rowid}}{{iddate}}{{ss.value_id}}" valuename="{{ss.value_name}}" check="{{s.check}}" rowid="{{rowid}}"></aproval-book>
      </template>  
      <center style="margin-top: 5%;">
          <paper-button on-click="fnsubmit1"  style="background-color:black;color:white">Submit</paper-button>
         <paper-button on-click="fnclose1" style="background-color:black;color:white">Close</paper-button>
      </center>
    </paper-dialog>
     <iron-ajax
        method="post"
        id="fngetconceptcheckajax"
        url="{{fngetconceptcheckurl}}"
        params="{{fngetconceptcheckparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fngetconceptcheckResponse"
        debounce-duration="300" />
       </iron-ajax>
          <iron-ajax
        method="post"
        id="fngetbookvaluezajax"
        url="{{fngetbookvaluezurl}}"
        params="{{fngetbookvaluezparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fngetbookvaluezResponse"
        debounce-duration="300" />
       </iron-ajax>
     <teacher-book-service-card id="bookservice"></teacher-book-service-card>

  </template>
  <script>
  (function() {
    'use strict';
     var tempvaluarr=[];
     var conarr=[];
     var valuearr=[];
    Polymer({
      is: 'aproval-book-innovatiosn-item-card',
fnsubmit:function(e){
 //this.$.bookservice.fnpassinsetconcept(conarr);
 this.$.dzfsd.toggle();
 var temp=[];
 for(var i=0;i<conarr.length;i++){
  if(conarr[i].rowid==this.rowid){
    temp.push({"conceptname":conarr[i].conceptname});
  }
 }
 // alert(JSON.stringify(temp));
 this.conceptzz=[];
 this.conceptzz=temp;
},
fnsubmit1:function(e){
 // alert(JSON.stringify(valuearr));
 this.$.dzfsd1xsasa.toggle();
 var temp1=[];
 for(var i=0;i<valuearr.length;i++){
  if(valuearr[i].rowid==this.rowid){
    temp1.push({"valuename":valuearr[i].valuename});
  }
 }
 //alert(JSON.stringify(temp1));
 this.massvalue=[];
 this.massvalue=temp1;
},
fnpasparr:function(e){
conarr=e;
// alert(JSON.stringify(conarr));
},
fnpasparr1:function(e){
  
valuearr=e;
},
fnclose:function(e){
this.$.dzfsd.close();
// for(var i=0;i<conarr.length;i++){
//   if(conarr[i].rowid==this.rowid){
    
//   }
//  }
// this.emsddsad=conarr1fsdfs;
// alert(JSON.stringify(this.emsddsad));
},
fnclose1:function(e){
this.$.dzfsd1xsasa.close();
},
    fnsavebook:function(e){
 if(this.period==""&&this.skill==""&&this.innovation==""&&this.remark==""&&this.valuez=="")
 {
      alert("Please insert the value");
  }
else if(this.planneddate=="empty"){
    //alert("save");
    //alert(JSON.stringify(conarr));
    this.$.bookservice.fnsetcoskill(conarr,this.period,this.skill,this.innovation,this.remark,this.rowid,this.valuez);
   //this.$.bookservice.fnsetcoskill1(conarr);
  //  this.$.bookservice.fnsetcovalue(valuearr,this.period,this.rowid);
      }
 else{
    //alert("edit");
      // alert(JSON.stringify(conarr));
 
    this.$.bookservice.fnbookeditskill(this.period,this.skill,this.innovation,this.remark,this.planneddate,this.rowidz,this.valuez);
  //this.$.bookservice.fnsetcovalue11(tempvaluarr,this.planneddate);
      }
   this.hidecheck1=true;
   this.hidecheck=false;
   this.planneddate="";
    document.querySelector('concept-check-card').fnclean();
  
   this.conceptjhkhzz="";
},

fngetconceptz:function(e){
  this.fngetconceptcheck();
  this.$.dzfsd.toggle(); 
},
fngetconceptz1:function(e){
   this.$.dzfsd1xsasa.toggle(); 
  this.fngetinchaptvaluevalue();
},
fngetinchaptvaluevalue:function(e){
this.fngetbookvaluezurl=sessionStorage.getItem("addrinfo")+"/fngetconceptvalue111-service";
           var obj={};
           obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
           obj.academic_year=localStorage.getItem("curr_sess_academicyear");
           obj.capter_id=localStorage.getItem("curr_sess_capters");
           obj.period=this.period;
           obj.planneddate=this.planneddate;
           this.fngetbookvaluezparam=obj;
         // alert(JSON.stringify(obj));
           this.$.fngetbookvaluezajax.generateRequest();
},
fngetbookvaluezResponse:function(e){
var res1=e.detail.response.skillarr;
 var res=e.detail.response.conceptarr;
 //alert(JSON.stringify(res1));
 //alert(JSON.stringify(res));
          for(var j=0;j<res.length;j++){
            var flag=0;
              for(var i=0;i<res1.length;i++){
                  
                  if(res[j].value_id==res1[i].value_id)
                  {    
                   flag=1;
                   res[j].check=true;   
                  }
                 }
                 if(flag==0){
                  res[j].check=false;
                 }
                }
                 this.valuearrz=res;
               //  alert(JSON.stringify(this.valuearrz));
},
fngetconceptcheck:function(e){
this.fngetconceptcheckurl=sessionStorage.getItem("addrinfo")+"/fngetconceptvalue11-service";
           var obj={};
           obj.schoolid=sessionStorage.getItem("curr_sess_loggedschoolid");
           obj.academic_year=localStorage.getItem("curr_sess_academicyear");
           obj.capter_id=localStorage.getItem("curr_sess_capters");
           obj.period=this.period;
           obj.planneddate=this.planneddate;
           this.fngetconceptcheckparam=obj;
          // alert(JSON.stringify(obj));
           this.$.fngetconceptcheckajax.generateRequest();
          },
        fngetconceptcheckResponse:function(e){
          //alert(JSON.stringify(e.detail.response.returnval));
          var res1=e.detail.response.skillarr;
          var res=e.detail.response.conceptarr;
          for(var j=0;j<res.length;j++){
            var flag=0;
              for(var i=0;i<res1.length;i++){
                  
                  if(res[j].concept_id==res1[i].concept_id)
                  {    
                   flag=1;
                   res[j].check=true;   
                  }
                 }
                 if(flag==0){
                  res[j].check=false;
                 }
                }
      if(conarr.length>0){
        for(var i=0;i<conarr.length;i++){
          for(var j=0;j<res.length;j++){
            // res[j].check=false;
          // alert(conarr[i].conceptid+" "+res[j].concept_id+"  "+this.rowid+" "+conarr[i].rowid);
          if(conarr[i].conceptid==res[j].concept_id&&this.rowid==conarr[i].rowid){
            res[j].check=true;
          }
          }
        }
      }    
      // alert(JSON.stringify(res));      
      this.conceparr=res;
   },   
fndelete:function(e){
this.$.bookservice.buffdel();
},
 fneditbook:function(e){
  this.hidecheck1=false;
  this.hidecheck=true;
},
fnsetpassvalz:function(e){
 tempvaluarr=e;
},


   });
  })();
  </script>
</dom-module>
